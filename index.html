<html>
  <head>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-physics-system/dist/aframe-physics-system.js"></script>

    <script>
      var ghosts = 25, coords;
      function toggle(t, s) {
        document.querySelector('a-scene').setAttribute('fog', 'far:1');
        document.getElementById('txt').setAttribute('text','value:' + t);
        setTimeout(function () {
          document.getElementById('cam1').setAttribute('active','false');
          document.getElementById('cam2').setAttribute('active','true');
        }, 3000);
        setTimeout(function(){
          document.getElementById('txt').setAttribute('position', '0 0 1');
          document.querySelector('a-scene').setAttribute('fog', 'near: 2');
        },6000);
        document.getElementById('player').setAttribute('src', s);
        document.getElementById('player').components.sound.playSound();
      }
    </script>
    <script>
      AFRAME.registerComponent('colliding', {
        init: function () {
          coords = document.getElementById('cam1');
          document.querySelector('a-scene').addEventListener('enter-vr', function () { coords = document.getElementById('rig'); });
          document.querySelector('a-scene').addEventListener('exit-vr', function () { coords = document.getElementById('cam1'); });
        },
        tick: function () {
          var pos1 = coords.getAttribute('position');
          var pos2 = this.el.getAttribute('position');
          if (Math.abs(pos1.x - pos2.x) < 40 && Math.abs(pos1.z - pos2.z) < 40) toggle('GAME OVER', '#explode');

          var rot = document.getElementById('spacecraft').getAttribute('rotation');
          var distance = Math.sqrt(pos1.x * pos1.x + pos1.z * pos1.z);
          var angle = Math.atan2(pos1.x, pos1.z) * 180 / Math.PI;
          if (angle < 0) angle = 360 + angle;
          if ((Math.abs(rot.y - angle) < 30 || Math.abs(rot.y - angle) > 345) && distance < 250) toggle('GAME OVER', '#police');
        }
      });
    </script>
    <script>
      AFRAME.registerComponent('ghosting', {
        init: function () {
          this.el.addEventListener('mouseenter', function () {
            document.getElementById('shot').components.sound.playSound();
            document.getElementById('laser').setAttribute('line', 'start: 0 -0.1 0; end: 0 0 -1; color:lime');
          });
          this.el.addEventListener('mouseleave', function () {
            document.getElementById('laser').removeAttribute('line');
            this.remove(); ghosts--;
            if (ghosts <= 0) toggle('WELL DONE', '#scream');
          });
        },
        tick: function () {
          if (Math.random() < 0.99) return;
          var x = Math.random() * 700 - 350;
          var y = Math.random() * 50 + 10;
          var z = Math.random() * 700 - 350;
          this.el.setAttribute('animation', 'property: position; to: ' + x + ' ' + y + ' ' + z);
        }
      });
    </script>

  </head>
  <body>
    <a-scene>
      <a-assets>
        <a-asset-item id="tree" src="tree.glb"></a-asset-item>
        <a-asset-item id="ghost" src="ghost.gltf"></a-asset-item>
        <a-asset-item id="craft" src="spacecraft.glb"></a-asset-item>
        <img id="stars" src="eso0932a.jpg">
        <img id="earth" src="flat_earth03.jpg">
        <audio id="gun" src="mixkit-short-laser-gun-shot-1670.wav"></audio>
        <audio id="explode" src="mixkit-explosion-in-battle-2809.wav"></audio>
        <audio id="police" src="mixkit-police-siren-us-1643.wav"></audio>
        <audio id="scream" src="mixkit-battle-man-scream-2175.wav"></audio>
      </a-assets>
      
      <a-sky radius="5000" src="#stars" animation="property: rotation; to: 0 90 -30; dur: 20000"></a-sky>
      <a-sphere radius="1000" src="#earth" animation="property: rotation; to: -30 360 0; dur: 30000"></a-sphere>
      <!-- Rest of your a-entity components go here -->
    </a-scene>
  </body>
</html>

